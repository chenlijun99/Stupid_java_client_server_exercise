<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Chen Lijun 4E">
<title>Relazione su &#8220;Chatline multiclient&#8221;</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Relazione su &#8220;Chatline multiclient&#8221;</h1>
<div class="details">
<span id="author" class="author">Chen Lijun 4E</span><br>
<span id="email" class="email"><a href="mailto:chenlijun5858@gmai.com">chenlijun5858@gmai.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduzione">1. Introduzione</a>
<ul class="sectlevel2">
<li><a href="#_in_cosa_consiste_il_progetto">1.1. In cosa consiste il progetto</a></li>
<li><a href="#_materiali_usati">1.2. Materiali usati</a></li>
</ul>
</li>
<li><a href="#_l_applicazione">2. L&#8217;applicazione</a>
<ul class="sectlevel2">
<li><a href="#_esecuzione_dell_applicazione">2.1. Esecuzione dell&#8217;applicazione</a></li>
<li><a href="#_struttura_dell_applicazione">2.2. Struttura dell&#8217;applicazione</a></li>
<li><a href="#_funzionamento_generale_dell_applicazione">2.3. Funzionamento generale dell&#8217;applicazione</a>
<ul class="sectlevel3">
<li><a href="#_lato_server">2.3.1. Lato server</a></li>
<li><a href="#_lato_client">2.3.2. Lato client</a></li>
</ul>
</li>
<li><a href="#_codice_sorgente_completo">2.4. Codice Sorgente completo</a>
<ul class="sectlevel3">
<li><a href="#_client_java">2.4.1. Client.java</a></li>
<li><a href="#_server_java">2.4.2. Server.java</a></li>
<li><a href="#_serverdispatcher_java">2.4.3. ServerDispatcher.java</a></li>
<li><a href="#_clientsender_java">2.4.4. ClientSender.java</a></li>
<li><a href="#_clientlistener_java">2.4.5. ClientListener.java</a></li>
<li><a href="#_message_java">2.4.6. Message.java</a></li>
<li><a href="#_messagehistory_java">2.4.7. MessageHistory.java</a></li>
<li><a href="#_clientinfo_java">2.4.8. ClientInfo.java</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_conclusione">3. Conclusione</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduzione">1. Introduzione</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#8220;<em>Chatline multiclient</em>&#8221; è nato come progetto supplementare
all&#8217;area di progetto della classe 4E indirizzo informatico dell&#8217;istituto <em>IISS Galileo Galilei</em>.</p>
</div>
<div class="paragraph">
<p>L&#8217;area di progetto in questione riguardava principalmente la materia <em>Sistemi e reti</em>.
Consisteva infatti nella creazione di una LAN (<em><strong>L</strong>ocal <strong>A</strong>read <strong>N</strong>etwork</em>)
usando dispositivi di rete (switch e router), questi ultimi forniti dalla scuola.</p>
</div>
<div class="paragraph">
<p>Ora, avendo una LAN, si è anche pensato di testarlo con qualcosa
di concreto e, perché no, divertente.
Così è nato, a seguito alla proposta del docente di <em>Informatica</em> Antimo Marzochella, il presente
progetto, che ha come fine ultimo, quello di integrare le conoscenze e abilità
maturate durante l&#8217;anno scolastico 2016-2017 inerenti alla programmazione con il
quanto appreso in <em>Sistemi e reti</em>.</p>
</div>
<div class="sect2">
<h3 id="_in_cosa_consiste_il_progetto">1.1. In cosa consiste il progetto</h3>
<div class="paragraph">
<p>Il presente progetto consiste nel <strong>completamento</strong> di un applicazione <em>client-server</em>,
di cui una prima versione funzionante era già stata fornita dal docente.</p>
</div>
<div class="paragraph">
<p>L&#8217;applicazione, che d&#8217;ora in poi denomineremo &#8220;<strong><em>Chatline</em></strong>&#8221;, disponeva inizialmente
di un server a cui più client si potevano connettere.
In questo caso il server non faceva altro che smistare i messaggi
 in arrivo a tutti gli altri client che
sono connessi ad quest&#8217;ultimo (quello che fa un Hub).</p>
</div>
<div class="paragraph">
<p>Ai singoli alunni è stato dunque richiesto di sviluppare la funzionalità che
permetta di salvare le conversazioni in un file di testo, che poi dovrà poter essere
letto per presentare ad ogni utente che si collega al server una storia dei messaggi
precedenti.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Applicazione client-server</div>
<div class="paragraph">
<p>Un tipo di applicazione in cui ci sono almeno due programmi in esecuzione:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il server</p>
</li>
<li>
<p>il client</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Server</dt>
<dd>
<p>programma che resta in attesa delle richieste di servizio da parte di uno o più client</p>
</dd>
<dt class="hdlist1">Client</dt>
<dd>
<p>programma che inizializza una connessione, attraverso la quale
si collega al server e può richiedere a questo servizi di cui ha bisogno.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il modello client-server è solo un modo di strutturare un applicazione e non
obbliga l&#8217;uso di tecnologie specifiche: basta che ci sia un componente che offra
dei servizi e uno che li usufruisce e che quindi i due comunichino
in qualche modo.</p>
</div>
<div class="paragraph">
<p>Di fatto però, quando si parla di applicazione client-server, si intende
un applicazione di rete in cui questi ultimi comunicano tramite la rete,
e in particolare tramite <strong><em>Socket</em></strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/client-server_model.svg" alt="client server model">
</div>
<div class="title">Figure 1. Modello client-server</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Socket</div>
<div class="paragraph">
<p>Un socket rappresenta un punto di connessione, cioè identifica univocamente un
processo (quindi un servizio) all’interno di un computer. Un socket è formato da
un indirizzo IP e una porta TCP.</p>
</div>
<div class="paragraph">
<p>Ad ogni applicazione in esecuzione che usa TCP (o UDP) come protocollo di trasporto viene
infatti associato dal sistema operativo un numero identificativo, chiamato porta.</p>
</div>
<div class="paragraph">
<p>Le porte virtuali sono 65.535, di cui le prime 1.023 sono dette <em>Well Known Port</em>,
in quanto associate a servizi noti come HTTP, FTP, ecc.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_materiali_usati">1.2. Materiali usati</h3>
<div class="paragraph">
<p>Linguaggio di programmazione utilizzato: <strong><em>Java</em></strong>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>Linguaggio imperativo, a tipizzazione statica, orientato agli
oggetti (OOP), interpretato (dalla JVM) e cross-platform.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Per la stesura del codice si è fatto ricorso a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>Vim</em></strong> insieme a vari plugins (sopratutto <em>Eclim</em>) per la stesura del codice</p>
</li>
<li>
<p>Siti come <a href="https://stackoverflow.com/">Stack Overflow</a> e in generale <a href="https://www.google.it">Google</a></p>
</li>
<li>
<p><strong><em>Git</em></strong>: famoso programma di controllo versione</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Invece per l&#8217;elaborazione della relazione sono stati usati i seguenti programmi</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>Asciidoctor</em></strong>: programma che traduce in formati quali HTML, PDF, EPUB, etc.
file scritti nel linguaggio a marcatori <em>Asciidoc</em></p>
</li>
<li>
<p><strong><em>Plantuml</em></strong>: programma che fornisce un linguaggio dichiarativo e sulla base
di questo genera immagini (diagrammi di classi, flow-chart, etc.) appropriati</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_l_applicazione">2. L&#8217;applicazione</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_esecuzione_dell_applicazione">2.1. Esecuzione dell&#8217;applicazione</h3>
<div class="listingblock">
<div class="title">Esecuzione server</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">$ java Server &lt;porta TCP&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Esecuzione client</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">$ java Client &lt;indirzzo server&gt; &lt;porta TCP&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_struttura_dell_applicazione">2.2. Struttura dell&#8217;applicazione</h3>
<div class="imageblock">
<div class="content">
<img src="./images/class_diagrams/lato_client.svg" alt="lato client">
</div>
<div class="title">Figure 2. Server</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/class_diagrams/lato_server.svg" alt="lato server">
</div>
<div class="title">Figure 3. Client</div>
</div>
</div>
<div class="sect2">
<h3 id="_funzionamento_generale_dell_applicazione">2.3. Funzionamento generale dell&#8217;applicazione</h3>
<div class="sect3">
<h4 id="_lato_server">2.3.1. Lato server</h4>
<div class="ulist">
<ul>
<li>
<p>Il server occupa una porta TCP.</p>
</li>
<li>
<p>Il server crea un thread a parte, <em>ServerDispatcher</em>, che si occupa
di inoltrare i messaggi a tutti i client.</p>
</li>
<li>
<p>Il server resta in attesa di una richiesta di connessione.</p>
</li>
<li>
<p>Al ogni richiesta a di connessione il server crea 2 thread separati,
uno che aspetta di ricevere messaggi dal client (<em>ClientListener</em>) e l&#8217;altro che si occupa
di inviare i messaggi al client (<em>ClientSender</em>), associati alla connessione tramite
un oggetto della classe <em>ClientInfo</em>.<br>
Per cui ogni ClientSender e ClientListener avrà come membro la <em>ClientInfo</em>
a cui è associato.</p>
</li>
<li>
<p>Il server poi aggiunge al ServerDispatcher le informazioni (<em>ClientInfo</em>)
riguardo la connessione appena creata (ServerDispatcher possiede un elenco
di connessioni a cui poi inoltrerà i messaggi).</p>
</li>
<li>
<p>Quando arriva un messaggio al server, il <em>ClientListener</em> chiamerà
il metodo della classe <em>ServerDispatcher</em> che si occupa di inoltrare
il messaggio a tutti i client mandandoli al <em>Sender</em> associato.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/flowcharts/Server.svg" alt="Server">
</div>
<div class="title">Figure 4. Server</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/flowcharts/ClientListener.svg" alt="ClientListener">
</div>
<div class="title">Figure 5. ClientListener</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/flowcharts/ServerDispatcher.svg" alt="ServerDispatcher">
</div>
<div class="title">Figure 6. ServerDispatcher</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/flowcharts/ClientSender.svg" alt="ClientSender">
</div>
<div class="title">Figure 7. ClientSender</div>
</div>
</div>
<div class="sect3">
<h4 id="_lato_client">2.3.2. Lato client</h4>
<div class="ulist">
<ul>
<li>
<p>Il client fa una richiesta di connessione.</p>
</li>
<li>
<p>Dopo aver ottenuto l&#8217;accettazione dal server, il client crea
un thread a parte che si occupa di mandare i messaggi al server,
mentre il main-thread fungerà da listener.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/flowcharts/Client.svg" alt="Client">
</div>
<div class="title">Figure 8. Client</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/flowcharts/Sender.svg" alt="Sender">
</div>
<div class="title">Figure 9. Sender</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_codice_sorgente_completo">2.4. Codice Sorgente completo</h3>
<div class="sect3">
<h4 id="_client_java">2.4.1. Client.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.net.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.SimpleDateFormat</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Client</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">Socket</span> <span class="tok-n">m_connection</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">ObjectInputStream</span> <span class="tok-n">m_fromServer</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">ObjectOutputStream</span> <span class="tok-n">m_toServer</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">m_address</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">m_serverPort</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">Client</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">==</span> <span class="tok-mi">2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Client</span><span class="tok-o">(</span><span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">],</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]));</span>
		<span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
			<span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Client</span><span class="tok-o">(</span><span class="tok-s">&quot;127.0.0.1&quot;</span><span class="tok-o">,</span> <span class="tok-mi">8080</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
		<span class="tok-n">c</span><span class="tok-o">.</span><span class="tok-na">talk</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-nf">Client</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">address</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">serverPort</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_serverPort</span> <span class="tok-o">=</span> <span class="tok-n">serverPort</span><span class="tok-o">;</span>
		<span class="tok-n">m_address</span> <span class="tok-o">=</span> <span class="tok-n">address</span><span class="tok-o">;</span>
		<span class="tok-k">try</span> <span class="tok-o">{</span>
			<span class="tok-n">m_connection</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Socket</span><span class="tok-o">(</span><span class="tok-n">m_address</span><span class="tok-o">,</span> <span class="tok-n">m_serverPort</span><span class="tok-o">);</span>
			<span class="tok-n">m_fromServer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span><span class="tok-n">m_connection</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">());</span>
			<span class="tok-n">m_toServer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span><span class="tok-n">m_connection</span><span class="tok-o">.</span><span class="tok-na">getOutputStream</span><span class="tok-o">());</span>

			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Connected to server &quot;</span> <span class="tok-o">+</span> <span class="tok-n">m_connection</span><span class="tok-o">.</span><span class="tok-na">getInetAddress</span><span class="tok-o">().</span><span class="tok-na">getHostName</span><span class="tok-o">()</span> <span class="tok-o">+</span>
					<span class="tok-s">&quot; at &quot;</span> <span class="tok-o">+</span> <span class="tok-n">m_address</span> <span class="tok-o">+</span> <span class="tok-s">&quot;:&quot;</span> <span class="tok-o">+</span> <span class="tok-n">m_serverPort</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
		<span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">ioe</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">err</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can not establish connection to &quot;</span> <span class="tok-o">+</span>
					<span class="tok-n">m_address</span> <span class="tok-o">+</span> <span class="tok-s">&quot;:&quot;</span> <span class="tok-o">+</span> <span class="tok-n">m_serverPort</span><span class="tok-o">);</span>
			<span class="tok-n">ioe</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">exit</span><span class="tok-o">(-</span><span class="tok-mi">1</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">talk</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">Sender</span> <span class="tok-n">sender</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Sender</span><span class="tok-o">(</span><span class="tok-n">m_toServer</span><span class="tok-o">);</span>
		<span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">setDaemon</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
		<span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
		<span class="tok-k">try</span> <span class="tok-o">{</span>
			<span class="tok-n">Message</span> <span class="tok-n">message</span><span class="tok-o">;</span>
			<span class="tok-k">while</span> <span class="tok-o">((</span><span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Message</span><span class="tok-o">)</span><span class="tok-n">m_fromServer</span><span class="tok-o">.</span><span class="tok-na">readObject</span><span class="tok-o">())</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">printf</span><span class="tok-o">(</span><span class="tok-s">&quot;\b\b%30s%s %s %s\n%30s%s\n\n&gt; &quot;</span><span class="tok-o">,</span>
						<span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span>
						<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getSenderUsername</span><span class="tok-o">(),</span>
						<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getSenderAddress</span><span class="tok-o">(),</span>
						<span class="tok-k">new</span> <span class="tok-n">SimpleDateFormat</span><span class="tok-o">(</span><span class="tok-s">&quot;yyyy-MM-dd, hh:mm:ss&quot;</span><span class="tok-o">).</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getDate</span><span class="tok-o">()),</span>
						<span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span>
						<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getPayload</span><span class="tok-o">());</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">ioe</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">err</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Connection to server broken.&quot;</span><span class="tok-o">);</span>
			<span class="tok-n">ioe</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">ClassNotFoundException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>

		<span class="tok-o">}</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
<span class="tok-kd">class</span> <span class="tok-nc">Sender</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span>
<span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">ObjectOutputStream</span> <span class="tok-n">m_toServer</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">Sender</span><span class="tok-o">(</span><span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_toServer</span> <span class="tok-o">=</span> <span class="tok-n">out</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-k">try</span> <span class="tok-o">{</span>
			<span class="tok-n">BufferedReader</span> <span class="tok-n">console</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BufferedReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">InputStreamReader</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">));</span>
			<span class="tok-k">while</span> <span class="tok-o">(!</span><span class="tok-n">isInterrupted</span><span class="tok-o">())</span> <span class="tok-o">{</span>
				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">printf</span><span class="tok-o">(</span><span class="tok-s">&quot;&gt; &quot;</span><span class="tok-o">);</span>
				<span class="tok-n">String</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-n">console</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">();</span>
				<span class="tok-n">Message</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Message</span><span class="tok-o">(</span><span class="tok-n">s</span><span class="tok-o">);</span>
				<span class="tok-n">m_toServer</span><span class="tok-o">.</span><span class="tok-na">writeObject</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
				<span class="tok-n">m_toServer</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">();</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">ioe</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_java">2.4.2. Server.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.BufferedReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.PrintStream</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.net.ServerSocket</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.net.Socket</span><span class="tok-o">;</span>

<span class="tok-cm">/**</span>
<span class="tok-cm">  Multithreaded Chat Server Implementation – Server</span>
<span class="tok-cm">  */</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Server</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">Socket</span> <span class="tok-n">m_connection</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">m_acceptedConnections</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">m_listeningPort</span> <span class="tok-o">=</span> <span class="tok-mi">4000</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">==</span> <span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">Server</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Server</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]));</span>
		<span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
			<span class="tok-n">Server</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Server</span><span class="tok-o">(</span><span class="tok-mi">8080</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-nf">Server</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">listeningPort</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_listeningPort</span> <span class="tok-o">=</span> <span class="tok-n">listeningPort</span><span class="tok-o">;</span>

		<span class="tok-k">try</span> <span class="tok-o">(</span><span class="tok-n">ServerSocket</span> <span class="tok-n">server</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ServerSocket</span><span class="tok-o">(</span><span class="tok-n">m_listeningPort</span><span class="tok-o">,</span> <span class="tok-n">m_acceptedConnections</span><span class="tok-o">))</span> <span class="tok-o">{</span>
			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Server running on port &quot;</span> <span class="tok-o">+</span> <span class="tok-n">m_listeningPort</span><span class="tok-o">);</span>

			<span class="tok-n">ServerDispatcher</span> <span class="tok-n">serverDispatcher</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ServerDispatcher</span><span class="tok-o">();</span>
			<span class="tok-n">serverDispatcher</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>

			<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-k">try</span> <span class="tok-o">{</span>

					<span class="tok-n">m_connection</span> <span class="tok-o">=</span> <span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">();</span>

					<span class="tok-n">ClientInfo</span> <span class="tok-n">clientInfo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClientInfo</span><span class="tok-o">();</span>
					<span class="tok-n">clientInfo</span><span class="tok-o">.</span><span class="tok-na">setSocket</span><span class="tok-o">(</span><span class="tok-n">m_connection</span><span class="tok-o">);</span>

					<span class="tok-n">ClientSender</span> <span class="tok-n">clientSender</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClientSender</span><span class="tok-o">(</span><span class="tok-n">clientInfo</span><span class="tok-o">,</span> <span class="tok-n">serverDispatcher</span><span class="tok-o">);</span>
					<span class="tok-n">ClientListener</span> <span class="tok-n">clientListener</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClientListener</span><span class="tok-o">(</span><span class="tok-n">clientInfo</span><span class="tok-o">,</span> <span class="tok-n">serverDispatcher</span><span class="tok-o">);</span>

					<span class="tok-n">clientInfo</span><span class="tok-o">.</span><span class="tok-na">setListener</span><span class="tok-o">(</span><span class="tok-n">clientListener</span><span class="tok-o">);</span>
					<span class="tok-n">clientInfo</span><span class="tok-o">.</span><span class="tok-na">setSender</span><span class="tok-o">(</span><span class="tok-n">clientSender</span><span class="tok-o">);</span>

					<span class="tok-n">clientListener</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
					<span class="tok-n">clientSender</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>

					<span class="tok-n">serverDispatcher</span><span class="tok-o">.</span><span class="tok-na">addClient</span><span class="tok-o">(</span><span class="tok-n">clientInfo</span><span class="tok-o">);</span>

				<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
					<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
				<span class="tok-o">}</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">exit</span><span class="tok-o">(-</span><span class="tok-mi">1</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>

	<span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_serverdispatcher_java">2.4.3. ServerDispatcher.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-cm">/**</span>
<span class="tok-cm">  Chat Server</span>

<span class="tok-cm"> * ServerDispatcher class is purposed to listen for messages received</span>
<span class="tok-cm"> * from clients and to dispatch them to all the clients connected to the</span>
<span class="tok-cm"> * chat server.</span>
<span class="tok-cm"> */</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Vector</span><span class="tok-o">;</span>


<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServerDispatcher</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span>
<span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;</span> <span class="tok-n">m_messageQueue</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;();</span>
	<span class="tok-kd">private</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">ClientInfo</span><span class="tok-o">&gt;</span> <span class="tok-n">m_clients</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">ClientInfo</span><span class="tok-o">&gt;();</span>

	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">addClient</span><span class="tok-o">(</span><span class="tok-n">ClientInfo</span> <span class="tok-n">clientInfo</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_clients</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">clientInfo</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">deleteClient</span><span class="tok-o">(</span><span class="tok-n">ClientInfo</span> <span class="tok-n">clientInfo</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-kt">int</span> <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-n">m_clients</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-n">clientInfo</span><span class="tok-o">);</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">index</span> <span class="tok-o">!=</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">m_clients</span><span class="tok-o">.</span><span class="tok-na">removeElementAt</span><span class="tok-o">(</span><span class="tok-n">index</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Adds given message to the dispatcher&#39;s message queue and notifies this</span>
<span class="tok-cm">	 * thread to wake up the message queue reader (getNextMessageFromQueue method).</span>
<span class="tok-cm">	 * dispatchMessage method is called by other threads (ClientListener) when</span>
<span class="tok-cm">	 * a message is arrived.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">dispatchMessage</span><span class="tok-o">(</span><span class="tok-n">Message</span> <span class="tok-n">message</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
		<span class="tok-n">notify</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * @return and deletes the next message from the message queue. If there is no</span>
<span class="tok-cm">	 * messages in the queue, falls in sleep until notified by dispatchMessage method.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kd">private</span> <span class="tok-kd">synchronized</span> <span class="tok-n">Message</span> <span class="tok-nf">getNextMessageFromQueue</span><span class="tok-o">()</span>
			<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span>
		<span class="tok-o">{</span>
			<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
				<span class="tok-n">wait</span><span class="tok-o">();</span>
			<span class="tok-n">Message</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
			<span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">removeElementAt</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
			<span class="tok-k">return</span> <span class="tok-n">message</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Sends given message to all clients in the client list. Actually the</span>
<span class="tok-cm">	 * message is added to the client sender thread&#39;s message queue and this</span>
<span class="tok-cm">	 * client sender thread is notified.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kd">private</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">sendMessageToAllClients</span><span class="tok-o">(</span><span class="tok-n">Message</span> <span class="tok-n">message</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">m_clients</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
			<span class="tok-n">m_clients</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">).</span><span class="tok-na">getSender</span><span class="tok-o">().</span><span class="tok-na">sendMessage</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-k">try</span> <span class="tok-o">{</span>
			<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-n">Message</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-n">getNextMessageFromQueue</span><span class="tok-o">();</span>
				<span class="tok-n">MessageHistory</span> <span class="tok-n">history</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MessageHistory</span><span class="tok-o">(</span><span class="tok-s">&quot;history.txt&quot;</span><span class="tok-o">);</span>
				<span class="tok-n">history</span><span class="tok-o">.</span><span class="tok-na">addMessage</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
				<span class="tok-n">sendMessageToAllClients</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clientsender_java">2.4.4. ClientSender.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.ObjectOutputStream</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.net.Socket</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Vector</span><span class="tok-o">;</span>

<span class="tok-cm">/**</span>
<span class="tok-cm">  Chat Server</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * Sends messages to the client. Messages are stored in a message queue. When</span>
<span class="tok-cm"> * the queue is empty, ClientSender falls in sleep until a new message is</span>
<span class="tok-cm"> * arrived in the queue. When the queue is not empty, ClientSender sends the</span>
<span class="tok-cm"> * messages from the queue to the client socket.</span>
<span class="tok-cm"> */</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClientSender</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span>
<span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;</span> <span class="tok-n">m_messageQueue</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;();</span>

	<span class="tok-kd">private</span> <span class="tok-n">ServerDispatcher</span> <span class="tok-n">m_serverDispatcher</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">ClientInfo</span> <span class="tok-n">m_clientInfo</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">ObjectOutputStream</span> <span class="tok-n">m_output</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">ClientSender</span><span class="tok-o">(</span><span class="tok-n">ClientInfo</span> <span class="tok-n">clientInfo</span><span class="tok-o">,</span> <span class="tok-n">ServerDispatcher</span> <span class="tok-n">serverDispatcher</span><span class="tok-o">)</span>
			<span class="tok-kd">throws</span> <span class="tok-n">IOException</span>
		<span class="tok-o">{</span>
			<span class="tok-n">m_clientInfo</span> <span class="tok-o">=</span> <span class="tok-n">clientInfo</span><span class="tok-o">;</span>
			<span class="tok-n">m_serverDispatcher</span> <span class="tok-o">=</span> <span class="tok-n">serverDispatcher</span><span class="tok-o">;</span>
			<span class="tok-n">Socket</span> <span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-n">clientInfo</span><span class="tok-o">.</span><span class="tok-na">getSocket</span><span class="tok-o">();</span>
			<span class="tok-n">m_output</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span><span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getOutputStream</span><span class="tok-o">());</span>
			<span class="tok-n">m_output</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Adds given message to the message queue and notifies this thread</span>
<span class="tok-cm">	 * (actually getNextMessageFromQueue method) that a message is arrived.</span>
<span class="tok-cm">	 * sendMessage is called by other threads (ServeDispatcher).</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">sendMessage</span><span class="tok-o">(</span><span class="tok-n">Message</span> <span class="tok-n">message</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
		<span class="tok-n">notify</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * @return and deletes the next message from the message queue. If the queue</span>
<span class="tok-cm">	 * is empty, falls in sleep until notified for message arrival by sendMessage</span>
<span class="tok-cm">	 * method.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kd">private</span> <span class="tok-kd">synchronized</span> <span class="tok-n">Message</span> <span class="tok-nf">getNextMessageFromQueue</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span>
	<span class="tok-o">{</span>
		<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
			<span class="tok-n">wait</span><span class="tok-o">();</span>
		<span class="tok-n">Message</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
		<span class="tok-n">m_messageQueue</span><span class="tok-o">.</span><span class="tok-na">removeElementAt</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
		<span class="tok-k">return</span> <span class="tok-n">message</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Sends given message to the client&#39;s socket.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">sendMessageToClient</span><span class="tok-o">(</span><span class="tok-n">Message</span> <span class="tok-n">message</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_output</span><span class="tok-o">.</span><span class="tok-na">writeObject</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
		<span class="tok-n">m_output</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Until interrupted, reads messages from the message queue</span>
<span class="tok-cm">	 * and sends them to the client&#39;s socket.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-k">try</span> <span class="tok-o">{</span>
			<span class="tok-c1">// first send all the history</span>
			<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Message</span> <span class="tok-n">m</span> <span class="tok-o">:</span> <span class="tok-k">new</span> <span class="tok-n">MessageHistory</span><span class="tok-o">(</span><span class="tok-s">&quot;history.txt&quot;</span><span class="tok-o">).</span><span class="tok-na">getHistory</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">))</span> <span class="tok-o">{</span>
				<span class="tok-n">sendMessageToClient</span><span class="tok-o">(</span><span class="tok-n">m</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>

			<span class="tok-c1">// wait for new messages</span>
			<span class="tok-k">while</span> <span class="tok-o">(!</span><span class="tok-n">isInterrupted</span><span class="tok-o">())</span> <span class="tok-o">{</span>
				<span class="tok-n">Message</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-n">getNextMessageFromQueue</span><span class="tok-o">();</span>
				<span class="tok-n">sendMessageToClient</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>

		<span class="tok-n">m_clientInfo</span><span class="tok-o">.</span><span class="tok-na">getListener</span><span class="tok-o">().</span><span class="tok-na">interrupt</span><span class="tok-o">();</span>
		<span class="tok-n">m_serverDispatcher</span><span class="tok-o">.</span><span class="tok-na">deleteClient</span><span class="tok-o">(</span><span class="tok-n">m_clientInfo</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clientlistener_java">2.4.5. ClientListener.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.InputStreamReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.ObjectInputStream</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.net.Socket</span><span class="tok-o">;</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * Chat Server -</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * ClientListener class is purposed to listen for client messages and</span>
<span class="tok-cm"> * to forward them to ServerDispatcher.</span>
<span class="tok-cm"> */</span>


<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClientListener</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span>
<span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">ServerDispatcher</span> <span class="tok-n">m_serverDispatcher</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">ClientInfo</span> <span class="tok-n">m_clientInfo</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">ObjectInputStream</span> <span class="tok-n">m_input</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">ClientListener</span><span class="tok-o">(</span><span class="tok-n">ClientInfo</span> <span class="tok-n">clientInfo</span><span class="tok-o">,</span> <span class="tok-n">ServerDispatcher</span> <span class="tok-n">serverDispatcher</span><span class="tok-o">)</span>
			<span class="tok-kd">throws</span> <span class="tok-n">IOException</span>
    <span class="tok-o">{</span>

        <span class="tok-n">m_clientInfo</span> <span class="tok-o">=</span> <span class="tok-n">clientInfo</span><span class="tok-o">;</span>
        <span class="tok-n">m_serverDispatcher</span> <span class="tok-o">=</span> <span class="tok-n">serverDispatcher</span><span class="tok-o">;</span>
        <span class="tok-n">Socket</span> <span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-n">clientInfo</span><span class="tok-o">.</span><span class="tok-na">getSocket</span><span class="tok-o">();</span>

        <span class="tok-n">m_input</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span><span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Until interrupted, reads messages from the client socket, forwards them</span>
<span class="tok-cm">     * to the server dispatcher&#39;s queue and notifies the server dispatcher.</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span>
    <span class="tok-o">{</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
           <span class="tok-k">while</span> <span class="tok-o">(!</span><span class="tok-n">isInterrupted</span><span class="tok-o">())</span> <span class="tok-o">{</span>
               <span class="tok-n">Message</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Message</span><span class="tok-o">)</span> <span class="tok-n">m_input</span><span class="tok-o">.</span><span class="tok-na">readObject</span><span class="tok-o">();</span>
			   <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setSenderInfo</span><span class="tok-o">(</span><span class="tok-n">m_clientInfo</span><span class="tok-o">);</span>
               <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">message</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
                   <span class="tok-k">break</span><span class="tok-o">;</span>
               <span class="tok-n">m_serverDispatcher</span><span class="tok-o">.</span><span class="tok-na">dispatchMessage</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
           <span class="tok-o">}</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">ClassNotFoundException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>

        <span class="tok-c1">// Communication is broken. Interrupt both listener and sender threads</span>
        <span class="tok-n">m_clientInfo</span><span class="tok-o">.</span><span class="tok-na">getSender</span><span class="tok-o">().</span><span class="tok-na">interrupt</span><span class="tok-o">();</span>
        <span class="tok-n">m_serverDispatcher</span><span class="tok-o">.</span><span class="tok-na">deleteClient</span><span class="tok-o">(</span><span class="tok-n">m_clientInfo</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_message_java">2.4.6. Message.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.Serializable</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.SimpleDateFormat</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Date</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Message</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">m_senderUsername</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">m_senderAddress</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">Date</span> <span class="tok-n">m_date</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">m_payload</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>

	<span class="tok-n">Message</span><span class="tok-o">()</span> <span class="tok-o">{</span>

	<span class="tok-o">}</span>

	<span class="tok-n">Message</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">senderUsername</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">senderAddress</span><span class="tok-o">,</span> <span class="tok-n">Date</span> <span class="tok-n">date</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">payload</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_senderUsername</span> <span class="tok-o">=</span> <span class="tok-n">senderUsername</span><span class="tok-o">;</span>
		<span class="tok-n">m_senderAddress</span> <span class="tok-o">=</span> <span class="tok-n">senderAddress</span><span class="tok-o">;</span>
		<span class="tok-n">m_date</span> <span class="tok-o">=</span> <span class="tok-n">date</span><span class="tok-o">;</span>
		<span class="tok-n">m_payload</span> <span class="tok-o">=</span> <span class="tok-n">payload</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-n">Message</span><span class="tok-o">(</span><span class="tok-n">ClientInfo</span> <span class="tok-n">sender</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">payload</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_senderUsername</span> <span class="tok-o">=</span> <span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">getUsername</span><span class="tok-o">();</span>
		<span class="tok-n">m_senderAddress</span> <span class="tok-o">=</span> <span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">getAddress</span><span class="tok-o">();</span>
		<span class="tok-n">m_date</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">();</span>
		<span class="tok-n">m_payload</span> <span class="tok-o">=</span> <span class="tok-n">payload</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-n">Message</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">payload</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">m_payload</span> <span class="tok-o">=</span> <span class="tok-n">payload</span><span class="tok-o">;</span>
		<span class="tok-n">m_date</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setSenderInfo</span><span class="tok-o">(</span><span class="tok-n">ClientInfo</span> <span class="tok-n">sender</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_senderUsername</span> <span class="tok-o">=</span> <span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">getUsername</span><span class="tok-o">();</span>
		<span class="tok-n">m_senderAddress</span> <span class="tok-o">=</span> <span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">getAddress</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getSenderUsername</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_senderUsername</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getSenderAddress</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_senderAddress</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">Date</span> <span class="tok-nf">getDate</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_date</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPayload</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_payload</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setSenderUsername</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">senderUsername</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_senderUsername</span> <span class="tok-o">=</span> <span class="tok-n">senderUsername</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setSenderAddress</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">senderAddress</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_senderAddress</span> <span class="tok-o">=</span> <span class="tok-n">senderAddress</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDate</span><span class="tok-o">(</span><span class="tok-n">Date</span> <span class="tok-n">date</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_date</span> <span class="tok-o">=</span> <span class="tok-n">date</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setPayload</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">payload</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_payload</span> <span class="tok-o">=</span> <span class="tok-n">payload</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%s\\;%s\\;%s\\;%s&quot;</span><span class="tok-o">,</span>
					<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getSenderUsername</span><span class="tok-o">(),</span>
					<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getSenderAddress</span><span class="tok-o">(),</span>
					<span class="tok-k">new</span> <span class="tok-n">SimpleDateFormat</span><span class="tok-o">(</span><span class="tok-s">&quot;yyyy-MM-dd, hh:mm:ss&quot;</span><span class="tok-o">).</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getDate</span><span class="tok-o">()),</span>
					<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getPayload</span><span class="tok-o">());</span>

	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_messagehistory_java">2.4.7. MessageHistory.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.BufferedReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.File</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.FileReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.FileWriter</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.PrintWriter</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.ParseException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.SimpleDateFormat</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Calendar</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Date</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.StringTokenizer</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Vector</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MessageHistory</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">fileName_</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">MessageHistory</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">fileName</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-n">fileName_</span> <span class="tok-o">=</span> <span class="tok-n">fileName</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addMessage</span><span class="tok-o">(</span><span class="tok-n">Message</span> <span class="tok-n">message</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span>
	<span class="tok-o">{</span>
		<span class="tok-kt">boolean</span> <span class="tok-n">append</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-k">try</span> <span class="tok-o">(</span><span class="tok-n">PrintWriter</span> <span class="tok-n">fileOut</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FileWriter</span><span class="tok-o">(</span><span class="tok-n">fileName_</span><span class="tok-o">,</span> <span class="tok-n">append</span><span class="tok-o">)))</span> <span class="tok-o">{</span>
			<span class="tok-n">fileOut</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHistory</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span>
	<span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">getHistory</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHistory</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">dayFilter</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span>
	<span class="tok-o">{</span>
		<span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;</span> <span class="tok-n">messages</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Message</span><span class="tok-o">&gt;();</span>
		<span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-n">fileName_</span><span class="tok-o">);</span>
		<span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">createNewFile</span><span class="tok-o">();</span>

		<span class="tok-c1">// calculate the filter</span>
		<span class="tok-n">Date</span> <span class="tok-n">filter</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">dayFilter</span> <span class="tok-o">!=</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">Calendar</span> <span class="tok-n">calendar</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
			<span class="tok-n">calendar</span><span class="tok-o">.</span><span class="tok-na">setTime</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">());</span>
			<span class="tok-n">calendar</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">DATE</span><span class="tok-o">,</span> <span class="tok-o">-</span><span class="tok-n">dayFilter</span><span class="tok-o">);</span>
			<span class="tok-n">filter</span> <span class="tok-o">=</span> <span class="tok-n">calendar</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>

		<span class="tok-k">try</span> <span class="tok-o">(</span><span class="tok-n">BufferedReader</span> <span class="tok-n">fileIn</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BufferedReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FileReader</span><span class="tok-o">(</span><span class="tok-n">fileName_</span><span class="tok-o">)))</span> <span class="tok-o">{</span>
			<span class="tok-n">StringTokenizer</span> <span class="tok-n">tokenizer</span><span class="tok-o">;</span>
			<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">m</span><span class="tok-o">;</span> <span class="tok-o">(</span><span class="tok-n">m</span> <span class="tok-o">=</span> <span class="tok-n">fileIn</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">())</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">;)</span> <span class="tok-o">{</span>
				<span class="tok-n">tokenizer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StringTokenizer</span><span class="tok-o">(</span><span class="tok-n">m</span><span class="tok-o">,</span> <span class="tok-s">&quot;\\;&quot;</span><span class="tok-o">);</span>
				<span class="tok-n">Message</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Message</span><span class="tok-o">();</span>
				<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setSenderUsername</span><span class="tok-o">(</span><span class="tok-n">tokenizer</span><span class="tok-o">.</span><span class="tok-na">nextToken</span><span class="tok-o">());</span>
				<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setSenderAddress</span><span class="tok-o">(</span><span class="tok-n">tokenizer</span><span class="tok-o">.</span><span class="tok-na">nextToken</span><span class="tok-o">());</span>
				<span class="tok-n">String</span> <span class="tok-n">dateString</span> <span class="tok-o">=</span> <span class="tok-n">tokenizer</span><span class="tok-o">.</span><span class="tok-na">nextToken</span><span class="tok-o">();</span>
				<span class="tok-n">Date</span> <span class="tok-n">date</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SimpleDateFormat</span><span class="tok-o">(</span><span class="tok-s">&quot;yyyy-MM-dd, hh:mm:ss&quot;</span><span class="tok-o">).</span><span class="tok-na">parse</span><span class="tok-o">(</span><span class="tok-n">dateString</span><span class="tok-o">);</span>
				<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">filter</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">date</span><span class="tok-o">.</span><span class="tok-na">before</span><span class="tok-o">(</span><span class="tok-n">filter</span><span class="tok-o">))</span> <span class="tok-o">{</span>
					<span class="tok-k">continue</span><span class="tok-o">;</span>
				<span class="tok-o">}</span>
				<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setDate</span><span class="tok-o">(</span><span class="tok-n">date</span><span class="tok-o">);</span>
				<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setPayload</span><span class="tok-o">(</span><span class="tok-n">tokenizer</span><span class="tok-o">.</span><span class="tok-na">nextToken</span><span class="tok-o">());</span>

				<span class="tok-n">messages</span><span class="tok-o">.</span><span class="tok-na">addElement</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">ParseException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>

		<span class="tok-k">return</span> <span class="tok-n">messages</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clientinfo_java">2.4.8. ClientInfo.java</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-cm">/**</span>
<span class="tok-cm"> Chat Server</span>
<span class="tok-cm"> ClientInfo class contains information about a client, connected to the server.</span>
<span class="tok-cm"> */</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.net.Socket</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClientInfo</span>
<span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">Socket</span> <span class="tok-n">m_socket</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">ClientListener</span> <span class="tok-n">m_listener</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">ClientSender</span> <span class="tok-n">m_sender</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">m_username</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">m_address</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>


	<span class="tok-c1">//ClientInfo(Socket socket, ClientListener listener, ClientSender sender, String username) {</span>
		<span class="tok-c1">//m_socket = socket;</span>
		<span class="tok-c1">//m_listener = listener;</span>
		<span class="tok-c1">//m_sender = sender;</span>
		<span class="tok-c1">//m_username = username;</span>
	<span class="tok-c1">//}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setSender</span><span class="tok-o">(</span><span class="tok-n">ClientSender</span> <span class="tok-n">sender</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_sender</span> <span class="tok-o">=</span> <span class="tok-n">sender</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setListener</span><span class="tok-o">(</span><span class="tok-n">ClientListener</span> <span class="tok-n">listener</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_listener</span> <span class="tok-o">=</span> <span class="tok-n">listener</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setSocket</span><span class="tok-o">(</span><span class="tok-n">Socket</span> <span class="tok-n">socket</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_socket</span> <span class="tok-o">=</span> <span class="tok-n">socket</span><span class="tok-o">;</span>
		<span class="tok-n">setUsername</span><span class="tok-o">(</span><span class="tok-n">m_socket</span><span class="tok-o">.</span><span class="tok-na">getInetAddress</span><span class="tok-o">().</span><span class="tok-na">getHostName</span><span class="tok-o">());</span>
		<span class="tok-n">setAddress</span><span class="tok-o">(</span><span class="tok-n">m_socket</span><span class="tok-o">.</span><span class="tok-na">getInetAddress</span><span class="tok-o">().</span><span class="tok-na">getHostAddress</span><span class="tok-o">());</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUsername</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_username</span> <span class="tok-o">=</span> <span class="tok-n">username</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setAddress</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">address</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">m_address</span> <span class="tok-o">=</span> <span class="tok-n">address</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">ClientSender</span> <span class="tok-nf">getSender</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_sender</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">ClientListener</span> <span class="tok-nf">getListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_listener</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">Socket</span> <span class="tok-nf">getSocket</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_socket</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getUsername</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_username</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getAddress</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">m_address</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusione">3. Conclusione</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Questa esperienza è stata senza dubbio molto utile
per i singoli alunni, dato che spesso nell&#8217;ambito scolastico
ci si limita a scrivere piccoli programmi (dove per piccoli si
intende che non superano nemmeno le cento righe di codice) avendo
come unico scopo quello di imparare una determinata sintassi.</p>
</div>
<div class="paragraph">
<p>Diversamente invece, nella realizzazione di questo progetto, si ha potuto
provare un esperienza che si avvicina di più alla programmazione professionale.</p>
</div>
<div class="paragraph">
<p>Si è infatti partiti dalla lettura di un codice sorgente
scritto da terze parti, finendo col
aggiungere nuove funzionalità sulla base del codice fornito.</p>
</div>
<div class="paragraph">
<p>E questo è certamente significativo dal punto di vista
formativo, visto che nella programmazione la manutenzione occupa
molto più tempo di quello usato per l&#8217;implementazione.
Imparare sin da subito a leggere programmi scritti da altri
è fondamentale anche se spesso trascurato.</p>
</div>
<div class="paragraph">
<p>Nello sviluppo di &#8220;Chatline&#8221; invece abbiamo avuto la fortuna
di sviluppare queste abilità, che in un futuro prossimo, per chi
deciderà di continuare con la programmazione, sarà il pane
quotidiano.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-06 23:44:37 CEST
</div>
</div>
</body>
</html>